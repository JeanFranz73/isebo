CREATE TABLE "users" (
  "id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
  "username" VARCHAR(20),
  "name" VARCHAR(255),
  "email" VARCHAR(255),
  "phone" VARCHAR(255),
  "active" BOOLEAN DEFAULT true,
  PRIMARY KEY ("id", "username")
);

CREATE TABLE "user_devices" (
  "id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
  "user_id" INTEGER,
  "device_key" VARCHAR(255),
  "active" BOOLEAN DEFAULT true,
  PRIMARY KEY ("id")
);

CREATE TABLE "sessions" (
  "id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
  "user_id" INTEGER,
  "token" VARCHAR(255),
  "device_id" INTEGER,
  "active" BOOLEAN DEFAULT true,
  PRIMARY KEY ("id")
);

ALTER TABLE "user_devices" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

ALTER TABLE "sessions" ADD FOREIGN KEY ("user_id") REFERENCES "users" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;

ALTER TABLE "sessions" ADD FOREIGN KEY ("device_id") REFERENCES "user_devices" ("id") ON UPDATE NO ACTION ON DELETE NO ACTION;
